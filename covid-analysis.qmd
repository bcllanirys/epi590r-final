10

---
name: "Bella G"
title: "epi590r"
format: html
editor: visual
echo: false 
---

```{r}
#downloading packages
 

library(readr)
library(tidyverse)
library(gtsummary)
library(dplyr)
```

```{r}
#uploading covid dataset
install.packages("medicaldata")
library(medicaldata)
data(package="medicaldata")
covid <- medicaldata::covid_testing
class(covid)
covid <- as.data.frame(covid)

write_csv(covid, here::here("Data", "raw", "covid.csv"))


#cleaning data
covid_clean <- covid |>
  mutate(clinic_name = case_when(str_detect(clinic_name, "onc") ~ "oncology",str_detect(clinic_name, "mri") ~ "MRI", str_detect(clinic_name, "onc") ~ "oncology", str_detect(clinic_name, "rad") ~ "diagnosis radiology",str_detect(clinic_name, "urg") ~ "urgent care",
           str_detect(clinic_name, "lab") ~ "laboratory",str_detect(clinic_name, "ntwk") ~ "care network",
           str_detect(clinic_name, "hosp") ~ "hospital",
           str_detect(clinic_name, "ward") ~ "ward",
           TRUE ~ clinic_name 
         ),
         clinic_name = fct_lump(clinic_name, n = 10))

write_rds(covid_clean, here::here("R", "covid_clean.rds"))
write_csv(covid_clean, here::here("Data", "clean", "covid_clean.csv"))
```

1

```{r}
library(gtsummary)
library(broom)


 tbl_summary(
  data = covid_clean,
  by = gender,
  include = c(age, result, pan_day, test_id, clinic_name, payor_group, demo_group, patient_class),
  label = list(
    payor_group ~ "Paying method",
    pan_day ~ "# of days tested after pandemic start",
    test_id ~ "Type of test",
    clinic_name ~ "Clinic",
    demo_group ~ "Subject groups", 
    patient_class ~ "Subject disposition" 
  ),
  missing = "no")   |> 
 	add_overall(col_label = "**Total**") |> 
  bold_labels() |> 
  modify_footnote(update = everything() ~ NA) 
```

install.packages("Rcpp", dependencies = TRUE, INSTALL_opts = '--no-lock')1

```{r}


covid_clean$result_binary <- ifelse(covid_clean$result == "positive", 1, 0)

tbl_uvregression(
  data = covid_clean,
  y = result_binary,
  method = glm,
  method.args = list(family = binomial()),
  include = c(result_binary, age, pan_day,clinic_name, payor_group, demo_group, patient_class),
  label = list(
    age ~ "Age",
    pan_day ~ "# of Days Tested After Pandemic Start",
    clinic_name ~ "Clinic",
    payor_group ~ "Paying Method",
    demo_group ~ "Subject Groups",
    patient_class ~ "Subject Disposition"
  ) 
)


```
